services:
  god-mode:
    build: .
    container_name: god_mode_lab

    # --- HARDWARE ACCESS ---
    privileged: true

    # --- VISUAL BRIDGE ---
    network_mode: host
    environment:
      - DISPLAY=${DISPLAY} # Automatically grabs your Host's screen ID (e.g., :1)

    # --- SECRETS MANAGEMENT ---
    env_file:
      - .env.secrets # Use .env.secrets for actual secrets

    # --- PERSISTENCE LAYER ---
    volumes:
      - ./workspace:/root/workspace
      # Map X11 sockets so the GUI can "talk" to the screen
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
      # Note: .Xauthority mount disabled - not needed with xhost +local:root
      - $HOME/.Xauthority:/root/.Xauthority:rw

    # --- RESOURCE LIMITS ---
    deploy:
      resources:
        limits:
          cpus: '6.0'
          memory: 16G
        reservations:
          cpus: '2.0'
          memory: 4G
      # --- HEALTH CHECK ---
    healthcheck:
      test: [ "CMD", "docker", "version" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

    restart: unless-stopped
